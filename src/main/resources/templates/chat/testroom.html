<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>

    <meta charset="UTF-8">
    <title>Room</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link th:href="@{/css/chattest/chat.css}" rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{/css/chattest/animation.css}">
    <link rel="stylesheet" th:href="@{/css/chattest/fontello.css}">
    <link rel="stylesheet" th:href="@{/css/chattest/fontello-embedded.css}">
    <!--    <link rel="stylesheet" href=".${path}/resources/css/fontello-codes.css">-->
    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
    <style>
        body {
            background-color: #2c7ac9;
            font-family: 'Open Sans', sans-serif;
            display: flex;
            width: 100%;
            height: 100%;
            flex-direction: column;
        }

        h1 {
            display: flex;
            justify-content: center;
            font-size: 80px;
            margin-left: auto;
            margin-right: auto;
        }

        table {

            margin-left: auto;
            margin-right: auto;
            margin-bottom: 10px;
        }

        .box {
            width: 60%;
            padding: 10px;
            border-radius: 10px;
            background-color: #fff;
            margin: 0 auto;
        }

        .back {
            display: flex;
            float: left;
            width: 30px;
            height: 100px;
            margin-top: auto;
            margin-bottom: auto;
            float: left;

        }

        img {
            margin-left: 10px;
            margin-top: 10px;
            width: 30px;
            height: 30px;
        }

        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap');

        select {
            width: 500px;
            text-align: center;
            -moz-appearance: none;
            -webkit-appearance: none;
            appearance: none;
            font-family: sans-serif;
            font-size: 1.3rem;
            font-weight: 400;
            line-height: 1.5;
            height: 70px;
            width: 100%;
            border: 0.1px solid #E0E0E0;
            border-radius: 4px;
            margin: 8px 0;
            outline: none;
            padding: 8px;
            transition: .5s;
            color: #444;
            background-color: #fff;
            margin: 0;
            box-shadow: 0 1px 0 1px rgba(0, 0, 0, .04);
        }

        select:hover {
            border-color: #888;
        }

        select:focus {
            border-color: dodgerBlue;
            box-shadow: 0 0 8px 0 dodgerBlue;
        }

        select:disabled {
            opacity: 0.5;
        }

        /* links */
        .nfl a, .mlb a, .nhl a, .pga a {
            text-decoration: none;
            transition: color 0.2s ease-out;
        }

        .nfl a {
            color: rgb(0, 128, 64);
        }

        .nfl a:hover {
            color: darken(rgb(0, 128, 0), 20%);
        }

        .mlb a {
            color: rgb(128, 0, 128);
        }

        .mlb a:hover {
            color: darken(rgb(128, 0, 255), 20%);
        }

        .nhl a {
            color: rgba(231, 196, 104, 0.7);
        }

        .nhl a:hover {
            color: darken(rgba(231, 196, 104, 0.7), 20%);
        }

        .pga a {
            color: rgba(235, 118, 85, 1);
        }

        .pga a:hover {
            color: darken(rgba(235, 118, 85, 1), 20%);
        }

        /* wrapper */
        .wrapper {
            width: 100%;
            max-width: 1600px;
            margin: 20px auto 10px auto;
            padding: 0;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
            overflow: hidden;
            position: relative;
            text-align: center;
        }

        .container {
            width: 100%;
            left: 0;
            right: 0;
            text-align: center;
            margin-left: auto;
            margin-right: auto;
            background-color: #fff;
            position: absolute;
        }

        /* lists */
        .row ul {
            margin: 0;
            padding: 0;
        }

        .row ul li {
            margin: 0;
            font-size: 45px;
            font-weight: bold;
            list-style: none;
            display: inline-block;
            width: 25%;
            box-sizing: border-box;
            @media screen and (max-width: 767px) and (min-width: 480px) {
                font-size: 10px;
            }
            @media screen and (max-width: 479px) {
                font-size: 9px;
            }
        }

        .title ul li {
            padding: 15px 13px;
        }

        .row ul li {
            padding: 5px 10px;
        }


        /* rows */
        .row {
            padding: 0px 0;
            height: 100px;
            font-size: 0;
            position: relative;
            overflow: hidden;

            transition: all 0.2s ease-out;
            background-color: #62abf3;
            border-top: 1px solid darken(rgba(255, 255, 255, 0.1), 100%);
            @media only screen and (max-width: 767px) {
                font-size: 11px;
            }
        }

        .row:hover {
            background-color: #7ab7f5;
            height: 45px;
            @media screen and (max-width: 600px) {
                height: 85px;
            }
            @media screen and (max-width: 359px) {
                height: 105px;
            }
        }

        .title {
            padding: 25px 0 5px 0;
            height: 85px;
            font-size: 0;
            background-color: #3391f0;
            border-left: 3px solid lighten(rgba(255, 255, 255, 0.1), 100%);
            @media screen and (max-width: 767px) {
                font-size: 12px;
            }
        }

        .title:hover {
            height: 85px;
            background-color: #4b9ef2;
            border-left: 3px solid lighten(rgba(255, 255, 255, 0.1), 100%);
        }

        .title-hide {
            @media screen and (max-width: 767px) {
                display: none;
            }
        }

        .nfl {
            border-left: 3px solid darken(rgb(0, 128, 64), 30%);
        }

        .nfl:hover {
            border-left: 3px solid rgb(0, 128, 0);
        }

        .mlb {
            border-left: 3px solid darken(rgb(128, 0, 128), 30%);
        }

        .mlb:hover {
            border-left: 3px solid rgb(128, 0, 255);
        }

        .nhl {
            border-left: 3px solid darken(rgba(231, 196, 104, 0.7), 30%)
        }

        .nhl:hover {
            border-left: 3px solid rgba(231, 196, 104, 0.7);
        }

        .pga {
            border-left: 3px solid darken(rgba(235, 118, 85, 1), 30%);
        }

        .pga:hover {
            border-left: 3px solid rgba(235, 118, 85, 1);
        }

        /* row one - fadeIn */
        .row-fadeIn-wrapper {

            opacity: 0;
            font-size: 0;
            height: 0;
            overflow: hidden;
            position: relative;
            transition: all 0.2s ease-out;
            animation: fadeIn 1s ease-out 0.2s 1 alternate;
            animation-fill-mode: forwards;
        }

        .row-fadeIn-wrapper:hover {
            height: 80px;
            @media screen and (max-width: 767px) {
                height: 110px;
            }
            @media screen and (max-width: 359px) {
                height: 140px;
            }
        }

        .fadeIn {
            padding: 20px 0;
            font-size: 0;
            position: absolute;
            transition: all 0.2s ease-out;
            width: 100%;
        }

        .fadeIn:hover {
            background-color: lighten(rgba(0, 0, 0, 0.9), 10%);
        }

        /* logo */
        .btn1 {
            font-size: 20px;
            text-align: right;
            background-color: white;
            border: 0px;
        }

        .logo_btn {
            text-align: center;
        }


        /* row two - fadeOut */
        .row-fadeOut-wrapper {
            font-size: 0;
            overflow: hidden;
            position: relative;
            transition: all 0.2s ease-out;
            animation: fadeOut 0.4s ease-out 8s 1 alternate;
            animation-fill-mode: forwards;
            opacity: 1;
            height: 100px;
        }

        .row-fadeOut-wrapper:hover {
            height: 100px;
        }

        /* update content */
        .update-row {
            animation: update 0.5s ease-out 12s 1 alternate;
        }

        .update1 {
            position: absolute;
            top: 25px;
            display: inline-block;
            opacity: 1;
            animation: update1 1s ease-out 12s 1 alternate;
            animation-fill-mode: forwards;
        }

        .update2 {
            position: absolute;
            top: 25px;
            display: inline-block;
            opacity: 0;
            animation: update2 4s ease-out 13s 1 alternate;
            animation-fill-mode: forwards;
        }

        /* more content */
        ul.more-content li { /* 내부 내용 */
            font-weight: normal;
            position: relative;
            top: 20px;
            margin-bottom: 5px;
            font-size: 50px;
            color: #f04950;
            margin: 0;
            padding: 10px 13px;
            font-family: fantasy;
            display: block;
            height: 70px;
            width: 100%;
            color: darken(rgba(255, 255, 255, 0.9), 50%);
            @media screen and (max-width: 767px) {
                font-size: 11px;
            }
        }

        /* small content */
        .small {
            color: darken(rgba(255, 255, 255, 0.9), 60%);
            font-size: 10px;
            padding: 0 10px;
            margin: 0;
            @media screen and (max-width: 767px) {
                display: none;
            }
        }

        /* keyframe animations */
        @keyframes fadeIn {
            from {
                background: rgba(255, 255, 255, 0.1);
                opacity: 0;
                padding: 0;
            }
            to {
                background: darken(rgba(255, 255, 255, 0.1), 90%);
                opacity: 1;
                padding: 0 0 110px 0;
            }
            /*처음 보여지는 곳 */
        }

        @keyframes fadeOut {
            from {
                background: darken(rgba(255, 255, 255, 0.1), 80%);
                opacity: 1;
                height: 65px;
            }
            to {
                background: rgba(255, 255, 255, 0.1);
                opacity: 0;
                height: 0;
            }
        }

        @keyframes update {
            0% {
                background: darken(rgba(255, 255, 255, 0.1), 80%);
            }
            50% {
                background: rgba(255, 255, 255, 0.1);
            }
            100% {
                background: darken(rgba(255, 255, 255, 0.1), 80%);
            }
        }

        @keyframes update1 {
            0% {
                opacity: 0;
            }
            0% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }

        @keyframes update2 {
            0% {
                opacity: 0;
                color: rgba(255, 255, 255, 0.9);
            }
            20% {
                opacity: 1;
                color: rgba(82, 210, 154, 1);
            }
            100% {
                opacity: 1;
                color: rgba(255, 255, 255, 0.9);
            }
        }

        @media only screen and (max-width: 767px) {
            .row ul li {
                font-size: 13px;
            }
        }

        @media only screen and (max-width: 479px) {
            .row ul li {
                font-size: 15px;
            }
        }

        @media only screen and (max-width: 600px) {
            .row:hover {
                height: 85px;
            }
        }

        @media only screen and (max-width: 359px) {
            .row:hover {
                height: 105px;
            }
        }

        @media only screen and (max-width: 767px) {
            .row-fadeIn-wrapper:hover {
                height: 100px;
            }
        }

        @media only screen and (max-width: 359px) {
            .row-fadeIn-wrapper:hover {
                height: 75px;
            }
        }

        @media only screen and (max-width: 767px) {
            ul.more-content li {
                font-size: 11px;
            }
        }


        @media only screen and (max-width: 767px) {
            .gobutton {
                font-size: 10px;
            }
        }

        .btn {
            height: 140px;
            margin-left: 20px;

        }

        @media only screen and (max-width: 524px) {
            .btn {
                width: 150px;
                font-size: 25px;

            }

            @media only screen and (max-width: 524px) {
                input[type=text] {
                    width: 100%;
                    font-size: 10px;
                }
            }
    </style>
</head>
<!--<c:set var="name" value="${member.id}"/>-->
<script type="text/javascript">
    let token = $("meta[name='_csrf']").attr("content");
    let header = $("meta[name='_csrf_header']").attr("content");

    var ws;
    window.onload = function () {
        // <c:choose>
        //     <c:when test="${name eq 'admin'}">
        //getRoom();
        //      </c:when>
        //      <c:otherwise>
        // var id = '<c:out value="${name}"/>';
        //getRoomUser(id);
        //     </c:otherwise>
        // </c:choose>
        getRoom();
        createRoom();
    }

    function getRoom() {
        commonAjax('/chat/getRoom', "", 'post', function (result) {
            createChatingRoom(result);
        });
    }

    function getRoomUser(id) {

        var test = {ID: id};

        commonAjax('/chat/getRoomUser', test, 'post', function (result) {
            createChatingRoom(result);
        });
    }

    function createRoom() {
        $("#createRoom").click(function () {
            var msg = {
                roomName: $('#roomName').val(),
                sessionId: $('#sessionId').val()
                //description: $('#description').val()
            };

            commonAjax('/chat/createRoom', msg, 'post', function (result) {
                createChatingRoom(result);
            });

            $("#roomName").val("");
        });
    }


    function goRoom(number, name, sessionId) {
        location.href = "/chat/moveChating?roomName=" + name + "&" + "roomNumber="
            + number + "&" + "sessionId=" + sessionId;
    }

    function createChatingRoom(res) {
        if (res != null) {
            var tag = "<main class='row title'><ul><li class='num'>순서</li><li class='chatRoom'>방 이름</li><li class='sessionId'>작성자</li><li class='go'>참가</li></ul></main>";
            res.forEach(function (d, idx) {
                // var rn = d.chat_name.trim();
                var rn = d.room_name;
                var roomNumber = d.chat_room_num;
                var sessionId = d.chat_session_id;
                tag += "<div class='row nfl row-fadeIn-wrapper'>"
                    + "<ul><li class='num'>"
                    + (idx + 1)
                    + "</li>"
                    + "<li class='chatRoom'>"
                    + rn
                    + "</li>"
                    + "<li class='sessionId'>"
                    + sessionId
                    + "</li>"
                    + "<li class='go'><button type='button' class='gobutton' onclick='goRoom(\""
                    + roomNumber + "\", \"" + rn + "\", \""
                    + sessionId + "\")'>입장</button></li>"
                    + "</ul>"
                    + "<ul class='more-content'><li class='description'>"
                    // + description
                    + "마지막 채팅 내용 보여줄 예정"
                    + "</li></ul></div>";
            });

            $(".wrapper").empty().append(tag);
        }
    }

    function commonAjax(url, parameter, type, calbak, contentType) {
        $.ajax({
            url: url,
            data: parameter,
            type: type,
            beforeSend: function (xhr) {
                //데이터를 전송하기 전에 헤더에 csrf값을 설정합니다.
                xhr.setRequestHeader(header, token);
            },
            contentType: contentType != null ? contentType
                : 'application/x-www-form-urlencoded; charset=UTF-8',
            success: function (res) {
                calbak(res);
            },
            error: function (err) {
                console.log('error');
                calbak(err);
            }
        });
    }

</script>
<body>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:600' rel='stylesheet' type='text/css'>


<a class="btns tooltip tt50 download" href="#0">
      <span class="span1">
        <em>Download</em><i class="fa fa-download fa-2x"></i>
      </span>
</a>


<div class="container">
<span>
<a href='javascript:history.go(-1)' class="back"><img id="back-img"
                                                      th:src="@{/image/back.png}"></a>
		<h1>채팅방</h1>
	</span>
    <div class="wrapper">
    </div>

    <table class="inputTable">
        <tr>
            <th>방 제목</th>
            <th>
                <th:block th:with="pinfo=${#authentication.principal}">
                    <input type="text" name="roomName" id="roomName" placeholder="방제목을 지정" class="input_box" style="height:50px; max-width:1600px;  font-size: 1.5rem;
					font-family: sans-serif; ">
                    <input type="text" id="sessionId" name="sessionId" th:value="${pinfo.username}"
                           placeholder="세션 아이디"/>
                </th:block>
            </th>
            <th rowspan="2">
                <button id="createRoom" class="btn">방 만들기</button>

            </th>
        </tr>

        <tr>
            <th>설명</th>
            <th>
                <select id="description" name="description" onchange="alert_select_value(this);">
                    <option value="원격제어 요청">원격제어 요청</option>
                    <option value="pc고장진단">pc고장진단</option>
                    <option value="인터넷 연결문제">인터넷 연결문제</option>
                </select>
            </th>
            <th></th>
        </tr>
    </table>

    <div class="logo_btn">
        <hr>
        <button class="btn1" onclick="history.go(-1)">ⓒ<i class="icon-logo_jv">&nbsp;&nbsp;&nbsp;Corp</i></button>
    </div>

</div>
</body>
</html>