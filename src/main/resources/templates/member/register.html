<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>회원가입</title>
    <!-- plugins:css -->
    <link rel="stylesheet" th:href="@{/assets/vendors/mdi/css/materialdesignicons.min.css}">
    <link rel="stylesheet" th:href="@{/assets/vendors/css/vendor.bundle.base.css}">
    <link rel="stylesheet" th:href="@{/assets/css/style.css}">
    <link rel="shortcut icon" th:href="@{/assets/images/favicon.ico}">
    <link rel="stylesheet" th:href="@{/css/user/font.css}">

    <style>
        .text-muted {
            color: #6c757d !important;
            font-size: 14px;
        }

        .text-primary {
            color: #007bff !important;
        }

        .error-message {
            color: red;
            font-size: 12px;
            font-weight: bold;
        }

        .register-title {
            font-size: 17px;
            font-weight: bold;
        }

        .register-subtitle {
            font-size: 16px;
            font-weight: normal;
        }
        .form-control-custom {
            width: 80%; /* Adjust the width as needed */
            margin: 0 auto; /* Center the input field */
        }
    </style>

</head>
<body>
<div class="container-scroller">
    <div class="container-fluid page-body-wrapper full-page-wrapper">
        <div class="content-wrapper d-flex align-items-center auth">
            <div class="row flex-grow">
                <div class="col-lg-4 mx-auto">
                    <div class="auth-form-light text-left p-5">
                        <div class="brand-logo">
                            <img class="logo-center" th:src="@{/assets/images/LOGO_2.png}" alt="logo"/></div>
                        <h4 class="register-title">회원가입</h4>
                        <h6 class="register-subtitle font-weight-light">가입을 통해 더 다양한 서비스를 만나보세요!</h6>
                        <form class="registerForm" th:action="@{/user/joinProcess}" method="post" th:object="${user}">

                            <div class="form-group">
                                <label class="id">아이디</label>
                                <input type="text" id="id" class="form-control form-control-lg" th:field="*{userId}"
                                       placeholder="영 문자 4~20자로 입력 해 주세요)"/>
                                <span id="id_message"></span>
                                <span th:if="${#fields.hasErrors('userId')}" th:errors="*{userId}"
                                      class="error-message"></span>
                            </div>

                            <div class="form-group">
                                <label for="password">비밀번호</label>
                                <input type="password" id="password" th:field="*{userPassword}"
                                       autocomplete="new-password"
                                       placeholder="비밀번호 입력(문자,숫자 포함 4~12자)"
                                       class="form-control form-control-lg">
                                <span id="passwordError"></span>
                                <span th:if="${#fields.hasErrors('userPassword')}" th:errors="*{userPassword}"
                                      class="error-message"></span>
                            </div>

                            <div class="form-group">
                                <label for="confirmPassword">비밀번호 확인</label>
                                <input type="password" id="confirmPassword" th:field="*{confirmPassword}"
                                       autocomplete="new-password"
                                       placeholder="비밀번호 재 입력" class="form-control form-control-lg">
                                <span id="confirmPasswordError"></span>
                                <span th:if="${#fields.hasErrors('confirmPassword')}"
                                      th:errors="*{confirmPassword}" class="error-message"></span>
                            </div>
                            <div class="form-group">
                                <label for="name">이름</label>
                                <input type="text" id="name" placeholder="이름을 입력해 주세요" th:field="*{userName}"
                                       class="form-control form-control-lg">
                                <span id="nameError"></span>
                                <span th:if="${#fields.hasErrors('userName')}" th:errors="*{userName}"
                                      class="error-message"></span>
                            </div>

                            <div class="form-group">
                                <label for="email">이메일:</label>
                                <input type="email" id="email" placeholder="1111@gamil.com" th:field="*{userEmail}"
                                       class="form-control form-control-lg">
                                <span id="emailError"></span><br>
                                <span th:if="${#fields.hasErrors('userEmail')}" th:errors="*{userEmail}"
                                      class="error-message"></span>
                            </div>

                            <div class="form-group">
                                <label for="phone">전화번호:</label>
                                <input type="text" id="phone" th:field="*{userPhoneNumber}"
                                       class="form-control form-control-lg" placeholder="010-0000-0000">
                                <span id="phoneError"></span>
                                <span th:if="${#fields.hasErrors('userPhoneNumber')}"
                                      th:errors="*{userPhoneNumber}" class="error-message"></span>
                            </div>

                            <div class="form-group">
                                <label>성별</label>
                                <div>
                                    <div class="form-check form-check-flat form-check-primary">
                                        <label class="form-check-label">
                                            <input class="form-check-input" type="radio" th:field="*{userGender}"
                                                   id="genderMale" value="M"> 남
                                        </label>
                                    </div>
                                    <div class="form-check form-check-flat form-check-primary">
                                        <label class="form-check-label">
                                            <input class="form-check-input" type="radio" th:field="*{userGender}"
                                                   id="genderFemale" value="F"> 여
                                        </label>
                                    </div>
                                </div>
                                <span id="genderError"></span>
                                <span th:if="${#fields.hasErrors('userGender')}" th:errors="*{userGender}"
                                      class="error-message"></span>
                            </div>
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                            <input type="hidden" id="userProfilePicture" name="userProfilePicture"
                                   value="https://mbtiawsbucket.s3.ap-northeast-2.amazonaws.com/1718238271320-default.png">
                            <div class="mt-3">
                                <button class="btn btn-gradient-primary btn-lg btn-block" type="submit">가입하기</button>
                            </div>
                            <div class="text-center mt-4 font-weight-light text-muted">
                                이미 계정이 있으신가요? <a th:href="@{/user/login}" class="text-primary">로그인 하러 가기</a>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- content-wrapper ends -->
    </div>
    <!-- page-body-wrapper ends -->
</div>
<script th:src="@{/assets/vendors/js/vendor.bundle.base.js}"></script>
<script th:src="@{/assets/js/off-canvas.js}"></script>
<script th:src="@{/assets/js/hoverable-collapse.js}"></script>
<script th:src="@{/assets/js/misc.js}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script th:inline="javascript">
    let checkid = false;
    let checkemail = false;
    var token = $("meta[name='_csrf']").attr("content");
    var header = $("meta[name='_csrf_header']").attr("content");


    $(document).ready(function () {

        function hideServerErrorMessage() {
            $(this).siblings('.error-message').hide();
        }

        // Attach the hideServerErrorMessage function to the input fields
        $("input").on('input', hideServerErrorMessage);


        $("input[name='userId']").on('keyup', function () {
            const pattern = /^[A-Za-z]{1}[A-Za-z0-9]{3,19}$/
            const id = $(this).val();
            if (!pattern.test(id)) {
                $("#id_message").css({'color': 'red', 'font-size': '11px'}).html("영문자 숫자ID (4~20자리, 첫글자 숫자 X)");
                checkid = false;
                return;
            }
            $.ajax({
                url: "/user/idcheck",
                data: {"userId": id},
                success: function (resp) {
                    console.log(resp)
                    if (resp === -1) {
                        $("#id_message").html("사용 가능한 아이디 입니다").css({'color': 'green', 'font-size': '11px'});
                        checkid = true;
                    } else {
                        $("#id_message").html("사용중인 아이디입니다!").css({'color': 'red', 'font-size': '11px'});
                        checkid = false;
                    }
                }//success
            });//ajax
        });


        // 비밀번호 유효성 검사
        $("#password").on("keyup", function () {
            var password = $(this).val();
            const passwordPattern = /^(?=.*[a-zA-Z])((?=.*\d)|(?=.*\W)).{6,20}$/;
            if (!passwordPattern.test(password)) {
                $("#passwordError").html("비밀번호는 영문 대소문자와 숫자 4~12자리로 입력해야합니다").css({
                    'color': 'red',
                    'font-size': '11px'
                });
            } else {
                $("#passwordError").html("비밀번호 형식이 맞습니다.").css('color', 'green');
            }
        });


        // 비밀번호 확인 검사
        $("#confirmPassword").on("keyup", function () {
            var password = $("#password").val();
            var confirmPassword = $(this).val();
            if (password !== confirmPassword) {
                $("#confirmPasswordError").html("두 비밀번호가 맞지 않습니다.").css({'color': 'red', 'font-size': '12px'});
            } else {
                $("#confirmPasswordError").text("비밀번호가 동일합니다.").css('color', 'green');
            }
        });

        // 이름 유효성 검사
        $("#name").on("keyup", function () {
            var namePattern = /^[가-힣a-zA-Z]+$/;
            var name = $(this).val();
            if (!namePattern.test(name)) {
                $("#nameError").css({'color': 'red', 'font-size': '12px'}).html("한글,영문이름을 입력 해 주세요");
            } else {
                $("#nameError").html("");
            }
        });

        //이메일 유효성 검사
        $("#email").on("keyup", function () {
            var emailPattern = /^[a-z0-9_+.-]+@([a-z0-9-]+\.)+[a-z0-9]{2,4}$/;
            var email = $(this).val();
            if (!emailPattern.test(email)) {
                $("#emailError").css({'color': 'red', 'font-size': '11px'}).html("이메일 형식으로 입력 해 주세요 ex) xxx@gamil.com");
            } else {
                $("#emailError").html("");
            }
        });

        // 전화번호 유효성 검사
        $("#phone").on("keyup", function () {
            var phonePattern = /^01([0|1|6|7|8|9]?)-?([0-9]{3,4})-?([0-9]{4})$/;
            var phone = $(this).val().replace(/[^\d]/g, '');  // 숫자만 남기고 모든 문자 제거

            // 자동으로 하이픈 추가
            if (phone.length >= 4 && phone.length <= 7) {
                phone = phone.slice(0, 3) + "-" + phone.slice(3);
            } else if (phone.length >= 8) {
                phone = phone.slice(0, 3) + "-" + phone.slice(3, 7) + "-" + phone.slice(7);
            }
            $(this).val(phone);
            if (!phonePattern.test(phone)) {
                $("#phoneError").css({'color': 'red', 'font-size': '11px'}).html("휴대폰번호를 정확히 입력해주세요");
            } else {
                $("#phoneError").html("");
            }
        });


    });
</script>
</body>
</html>
